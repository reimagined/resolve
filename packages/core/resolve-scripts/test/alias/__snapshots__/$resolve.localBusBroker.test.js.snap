// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`local config works correctly [server] 1`] = `
"

    import '$resolve.guardOnlyServer'
    import { createAndInitPublisher, connectConsumer } from '@reimagined/local-event-broker'
    import eventBrokerConfig from '$resolve.eventBrokerConfig'

    if(module.parent != null) {
      setImmediate(() => process.exit(1))
      throw new Error('Event broker should be launched as independent process')
    }

    (async () => {
      try {
        const consumer = await connectConsumer({ ...eventBrokerConfig })
        const stopBroker = await createAndInitPublisher({
          ...eventBrokerConfig,
          connectConsumer
        })

        process.on('exit', stopBroker)
      } catch(error) {
        console.error('Event broker has run into an error:', error)

        process.exit(1)
      }
    })()
  
"
`;
