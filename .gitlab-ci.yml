stages:
  - install

job 1:
  stage: install
  tags:
    - ubuntu
  script: echo "ubuntu"

shopping-list-advanced (macOS):
  stage: install
  tags:
    - macos
  before_script:
    - rm -rf /Users/resolve/resolve
    - git clone -b feature/new-ci-initial git@172.22.7.16:github-mirror/resolve.git /Users/resolve/resolve
    - cd /Users/resolve/resolve
    - yarn
  script: 
    - cd /Users/resolve/resolve/examples/shopping-list-advanced
    - yarn build
    - cd /Users/resolve/resolve/examples/shopping-list-advanced/native
    - watchman watch-del-all
    - watchman shutdown-server
    - sleep 1
    - npx exp build:ios --type simulator
    - sleep 1
    - npx exp build:status | grep IPA | tail -1 | sed s/'^.*http'/'http'/g | xargs wget
    - sleep 1
    - ls -1 | grep simulator.tar.gz | xargs tar xvf
    - sleep 1
    - xcrun simctl boot 770A5B6B-ECD7-46A7-B5AB-CF694B3E2328
    - sleep 1
    - ls -1d */ | grep .app | xargs xcrun simctl install 770A5B6B-ECD7-46A7-B5AB-CF694B3E2328
    - sleep 1
    - xcrun simctl launch 770A5B6B-ECD7-46A7-B5AB-CF694B3E2328 com.resolve.shoppinglistadvanced
    - sleep 1
    - xcrun simctl terminate 770A5B6B-ECD7-46A7-B5AB-CF694B3E2328 com.resolve.shoppinglistadvanced
    - sleep 1
    - open /Applications/Calculator.app
  after_script:
    - cd /Users/resolve/resolve/examples/shopping-list-advanced/native
    - ls -1 | grep simulator.tar.gz | xargs unlink
    - xcrun simctl uninstall 770A5B6B-ECD7-46A7-B5AB-CF694B3E2328 com.resolve.shoppinglistadvanced
    - ls -1d */ | grep .app | xargs rm -rf
    - rm -rf /Users/resolve/resolve
