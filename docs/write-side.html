<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Write Side · reSolve</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;aggregates&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#aggregates&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Aggregates&lt;/h2&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Write Side · reSolve"/><meta property="og:type" content="website"/><meta property="og:url" content="https://reimagined.github.io/resolve/index.html"/><meta property="og:description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;aggregates&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#aggregates&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Aggregates&lt;/h2&gt;
"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/resolve/undefined"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://reimagined.github.io/resolve/blog/atom.xml" title="reSolve Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://reimagined.github.io/resolve/blog/feed.xml" title="reSolve Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-118635726-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/resolve/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/resolve/"><img class="logo" src="/resolve/img/resolve.svg" alt="reSolve"/><h2 class="headerTitleWithLogo">reSolve</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/resolve/blog/" target="_self">Blog</a></li><li class="siteNavGroupActive"><a href="/resolve/docs/" target="_self">Docs</a></li><li class="siteNavGroupActive"><a href="/resolve/docs/faq" target="_self">FAQ</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="https://github.com/reimagined/resolve" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Docs Index</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Docs Index</h3><ul><li class="navListItem"><a class="navItem" href="/resolve/docs/">reSolve Documentation</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/tutorial">Step-by-Step Tutorial</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Basics</h4><ul><li class="navListItem"><a class="navItem" href="/resolve/docs/app-structure">reSolve App Structure</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/resolve/docs/write-side">Write Side</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/read-side">Read Side</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/frontend">Frontend</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/curl">Standard HTTP API</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/resolve/docs/advanced-techniques">Advanced Techniques</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/api-handlers">API Handlers</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/authentication-and-authorization">Authentication and Authorization</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/preparing-to-production">Preparing to Production</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/api-reference">API Reference</a></li><li class="navListItem"><a class="navItem" href="/resolve/docs/contributing">Contributing</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">FAQ</h3><ul><li class="navListItem"><a class="navItem" href="/resolve/docs/faq">FAQ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Troubleshooting</h3><ul><li class="navListItem"><a class="navItem" href="/resolve/docs/troubleshooting">Troubleshooting</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Write Side</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="aggregates"></a><a href="#aggregates" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Aggregates</h2>
<p>Commands are executed by objects that encapsulate domain logic. These objects are called Domain Objects.
Usually Domain Objects are grouped into Aggregates. In a CQRS/ES app, an aggregate is a transaction boundary. This means that any given aggregate should be able to execute its commands without communicating with other aggregates.</p>
<p>Since the write side is used only to perform commands, your aggregate can be pretty slim, and only keep state that required for command execution.</p>
<p>See Martin Fowler's definition for aggregates in the DDD paradigm: <a href="https://martinfowler.com/bliki/DDD_Aggregate.html">https://martinfowler.com/bliki/DDD_Aggregate.html</a></p>
<p>In reSolve, an aggregate is a static object that contains a set of functions. of the following two kinds:</p>
<ul>
<li><a href="#aggregate-projection-function">Projections</a> - build aggregate state base from events.</li>
<li><a href="#aggregate-command-handlers">Command Handlers</a> - execute commands.</li>
</ul>
<p>Aggregate state is explicitly passed to all of these functions as an argument.</p>
<h2><a class="anchor" aria-hidden="true" id="aggregate-id"></a><a href="#aggregate-id" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Aggregate ID</h2>
<p>Each aggregate should have a unique ID that is immutable during the aggregate's lifetime. An Aggregate ID should stay unique in the given event store, however we also recommend to keep it
globally unique. It is also recommended that you generate aggregate IDs using <a href="https://github.com/kelektiv/node-uuid#version-4">UUID v4</a> or <a href="https://github.com/ericelliott/cuid">cuid</a> for distributed scalable apps.</p>
<p>Please note that you have to generate a new Aggregate ID and send it with a command that creates a new aggregate.</p>
<h2><a class="anchor" aria-hidden="true" id="configuring-aggregates"></a><a href="#configuring-aggregates" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuring Aggregates</h2>
<p>To configure aggregates in a reSolve app, provide an aggregates array in the application configuration file:</p>
<!-- prettier-ignore-start -->
<pre><code class="hljs css language-js">aggregates: [
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'ShoppingList'</span>,
      <span class="hljs-attr">commands</span>: <span class="hljs-string">'common/aggregates/shopping_list.commands.js'</span>,
      <span class="hljs-attr">projection</span>: <span class="hljs-string">'common/aggregates/shopping_list.projection.js'</span>
    }
  ]
</code></pre>
<!-- prettier-ignore-end -->
<h2><a class="anchor" aria-hidden="true" id="sending-a-command"></a><a href="#sending-a-command" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sending a Command</h2>
<p>You can emit aggregate commands in the following cases:</p>
<ul>
<li><a href="#sending-commands-from-the-client">Sending commands from the client</a></li>
<li><a href="#emitting-commands-on-the-server">Emitting commands on the server</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="sending-commands-from-the-client"></a><a href="#sending-commands-from-the-client" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sending Commands From the Client</h3>
<p>The reSolve framework exposes an <a href="/resolve/docs/api-reference#commands-http-api">HTTP API</a> that you can use to to send commands from the client side. Depending on the architecture of your web application's front-end, you can use this API directly or using the <strong>Redux</strong> binding mechanism provided by the <strong><a href="https://github.com/reimagined/resolve/tree/master/packages/core/resolve-redux">resolve-redux</a></strong> library.</p>
<p>You can send a command from the client side by sending a POST request to the following URL:</p>
<pre><code class="hljs">http:<span class="hljs-regexp">//</span>{host}:{port}<span class="hljs-regexp">/api/</span>commands
</code></pre>
<p>The request body should have the <code>application/json</code> content type and contain a JSON representation of the command:</p>
<pre><code class="hljs">{
  <span class="hljs-string">"aggregateName"</span>: aggregateName,
  <span class="hljs-string">"type"</span>: commandType,
  <span class="hljs-string">"aggregateId"</span>: aggregateID,
  <span class="hljs-string">"payload"</span>: {
    <span class="hljs-string">"param1"</span>: <span class="hljs-keyword">value</span><span class="hljs-number">1</span>,
    <span class="hljs-string">"param2"</span>: <span class="hljs-keyword">value</span><span class="hljs-number">2</span>,
    ...
    <span class="hljs-string">"paramN"</span>: valueN
  }
}
</code></pre>
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><strong>aggregateId</strong></td><td>string</td><td>The ID of an aggregate to which you are addressing the command</td></tr>
<tr><td><strong>aggregateName</strong></td><td>string</td><td>The aggregate's name as defined in <a href="../examples/shopping-list/config.app.js">config.app.js</a></td></tr>
<tr><td><strong>commandType</strong></td><td>string</td><td>The command type supported by <a href="../examples/shopping-list/common/aggregates">the aggregate</a></td></tr>
<tr><td><strong>payload</strong></td><td>object</td><td>The parameters that <a href="../examples/shopping-list/common/aggregates">the command</a> accepts</td></tr>
</tbody>
</table>
<h5><a class="anchor" aria-hidden="true" id="example"></a><a href="#example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h5>
<p>Use the following command to add an item to the <strong>shopping-list</strong> example.</p>
<pre><code class="hljs css language-sh">$ curl -X POST <span class="hljs-string">"http://localhost:3000/api/commands"</span>
--header <span class="hljs-string">"Content-Type: application/json"</span> \
--data <span class="hljs-string">'
{
  "aggregateName":"Todo",
  "type":"createItem",
  "aggregateId":"root-id",
  "payload": {
    "id":`date +%s`,
    "text":"Learn reSolve API"
  }
}
'</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="emitting-commands-on-the-server"></a><a href="#emitting-commands-on-the-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Emitting Commands on the Server</h3>
<p>You can emit a command on the server side from a <strong><a href="/resolve/docs/advanced-techniques#process-managers-sagas">Saga</a></strong> or <strong><a href="/resolve/docs/api-handlers">API Handler</a></strong> using the <strong>resolve.executeCommand</strong> function as shown below:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">await</span> resolve.executeCommand({
  <span class="hljs-attr">type</span>: userWithSameEmail ? <span class="hljs-string">'rejectUserCreation'</span> : <span class="hljs-string">'confirmUserCreation'</span>,
  <span class="hljs-attr">aggregateName</span>: <span class="hljs-string">'user'</span>,
  <span class="hljs-attr">payload</span>: { createdUser },
  aggregateId
})
</code></pre>
<p>For the full code sample, refer to the <a href="https://github.com/reimagined/resolve/tree/master/examples/with-saga">with-saga</a> example project.</p>
<h2><a class="anchor" aria-hidden="true" id="aggregate-command-handlers"></a><a href="#aggregate-command-handlers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Aggregate Command Handlers</h2>
<p>Aggregate command handlers are grouped into a static object. A command handler receives a command and a state object built by the aggregate <a href="#aggregate-projection-function">Projection</a>. The command handler should return an event object that is then saved to the <a href="#event-store">event store</a>. A returned object should specify an event type and a <strong>payload</strong> specific to this event type.</p>
<p>A typical <strong>Commands</strong> object structure:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// A command handler</span>
  createStory: <span class="hljs-function">(<span class="hljs-params">state, command</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { title, link, text } = command.payload
    <span class="hljs-comment">// The resulting event object</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'StoryCreated'</span>,
      <span class="hljs-attr">payload</span>: { title, text, link, userId, userName }
    }
  }
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="aggregate-projection-function"></a><a href="#aggregate-projection-function" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Aggregate Projection Function</h2>
<p>Projection functions are used to calculate an aggregate state based on the aggregate's events. A projection function receives a previous state and an event to be applied. It should return a new state based on the input.</p>
<p>Projection functions run for all events with the current aggregate ID. The resulting state is then passed to the corresponding <a href="#aggregate-command-handlers">command handler</a>.</p>
<p>In addition to projection functions, a projection object should define an <strong>Init</strong> function. This function returns initial state of the aggregate.</p>
<p>A typical projection object structure is shown below:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">Init</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ({}),
  <span class="hljs-attr">StoryCreated</span>: <span class="hljs-function">(<span class="hljs-params">state, { timestamp, payload: { userId } }</span>) =&gt;</span> ({
    ...state,
    <span class="hljs-attr">createdAt</span>: timestamp,
    <span class="hljs-attr">createdBy</span>: userId,
    <span class="hljs-attr">voted</span>: [],
    <span class="hljs-attr">comments</span>: {}
  })
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="event-store"></a><a href="#event-store" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Event Store</h2>
<p>All events returned by command handlers are saved to the event store. The reSolve framework writes events to the storage using one of the supported storage adapters.</p>
<p>You can specify the storage adapter in the <strong>storageAdapter</strong> config section:</p>
<pre><code class="hljs css language-js">storageAdapter: {
  <span class="hljs-attr">module</span>: <span class="hljs-string">'resolve-storage-lite'</span>,
  <span class="hljs-attr">options</span>: {
    pathToFile = <span class="hljs-string">'../event-storage.db'</span>
  }
}
</code></pre>
<p>Adapters for the following storage types are available out of the box:</p>
<ul>
<li><a href="https://github.com/reimagined/resolve/tree/master/packages/adapters/storage-adapters/resolve-storage-lite">File or memory</a></li>
<li><a href="https://github.com/reimagined/resolve/tree/master/packages/adapters/storage-adapters/resolve-storage-mongo">MongoDB</a></li>
<li><a href="https://github.com/reimagined/resolve/tree/master/packages/adapters/storage-adapters/resolve-storage-mysql">MySQL</a></li>
</ul>
<p>You can also write your own storage adapter and store events in any required way. To learn more about adapters, refer to the <a href="/resolve/docs/advanced-techniques#adapters">Adapters</a> section of the reSolve documentation.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/resolve/docs/app-structure"><span class="arrow-prev">← </span><span class="function-name-prevnext">reSolve App Structure</span></a><a class="docs-next button" href="/resolve/docs/read-side"><span>Read Side</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#aggregates">Aggregates</a></li><li><a href="#aggregate-id">Aggregate ID</a></li><li><a href="#configuring-aggregates">Configuring Aggregates</a></li><li><a href="#sending-a-command">Sending a Command</a><ul class="toc-headings"><li><a href="#sending-commands-from-the-client">Sending Commands From the Client</a></li><li><a href="#emitting-commands-on-the-server">Emitting Commands on the Server</a></li></ul></li><li><a href="#aggregate-command-handlers">Aggregate Command Handlers</a></li><li><a href="#aggregate-projection-function">Aggregate Projection Function</a></li><li><a href="#event-store">Event Store</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/resolve/" class="nav-home"><img src="/resolve/img/resolve.svg" alt="reSolve" width="66" height="58"/></a><div><h5>Docs</h5><a href="/resolve/docs/">Documentation Index</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/resolvejs" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/resolvejs" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.facebook.com/resolvejs/" target="_blank" rel="noreferrer noopener">Facebook</a></div><div><h5>More</h5><a href="https://github.com/reimagined/resolve">GitHub</a><a class="github-button" href="https://github.com/reimagined/resolve" data-icon="octicon-star" data-count-href="/reimagined/resolve/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 reimagined</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '2acd75b7a94d568aa418a4f02bd811cc',
                indexName: 'reimagined_resolve',
                inputSelector: '#search_input_react'
              });
            </script></body></html>